<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/imgs/favicon.png">
      <meta charset="utf-8">
  <script type="importmap">
      {
	"imports": {
	  "three": 
	      "https://unpkg.com/three@v0.154.0/build/three.module.js",
	  "three/addons/":
	      "https://unpkg.com/three@v0.154.0/examples/jsm/"
	}
      }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" 
           integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" 
           crossorigin="anonymous">
  </script>

<style>
  .dlgFrame
  {
    border-radius: 16px 16px 16px 16px;
    box-shadow: 3px 3px 5px #535353;
    background: lightYellow;
  }

</style>
</head>
<!--////////////////////////  END HEADERS ///////////////////-->
<script type=module>
  import  {THREE, GUI, loader, scene, camera, renderer} from "./init.js" ;
  import {Plane} from "./plane.js" ;
  import {light, dlight, lightGUI} from  "./lights.js" ;
  import {setColor, setPos, measure, saveScene} from "./util.js" ;
//  import {OrbitControls} from 'three/addons/controls/OrbitControls'

  let plane = await Plane () ;
  scene.add (plane) ;
  scene.add (light); 
  scene.add (dlight);
  genImages (true, 1) ;
//  scene.add (new THREE.AxesHelper(40)) ;


// Functions 
/////////////////////////////////////////////
function genImages (go, i) {
     render () ;
     sleep (1000).then (saveFile (go, i)) 
} // genImages

function saveFile (go, i) { 
// when go is false we stop saving
  return (
      () => { 
       if (go) { // do nothing if go is false 
	 let str = (plane.rotation.x).toFixed(0) +
	           (plane.rotation.y).toFixed(0) +
		   (plane.rotation.z).toFixed(0) ;

         let fname =  "p" + str + ".png"; 
         saveScene (fname); 
	 console.log("Saving " + fname) ;
         go = rotate (plane, 15) ;
	 i = i + 1 ;
         genImages (go, i) ; //
       }
      }) ;
} // end saveFile

function sleep (ms) {  // returns a promise
 console.log("Sleeping");
 return new Promise (resolve => setTimeout (resolve, ms)) ;
}

function animate(){
    requestAnimationFrame (animate);
    rotate (plane, 0.01) ;
    renderer.render (scene, camera);
  }

function render() {
    requestAnimationFrame (render);
    renderer.render (scene, camera);
}

function resize_canvas( x = 512, y = 512 ) {
  // not giving good result
  var  canvas = document.getElementsByTagName('canvas')[0];
  canvas.width = x;
  canvas.height = y;
  camera.aspect = canvas.clientWidth / canvas.clientHeight;
  camera.updateProjectionMatrix();
}

function rotate(obj, dt) {
  // Keep rotatting until all combos done
  if (obj.rotation.z < 45)   obj.rotation.z += dt;
  if (obj.rotation.y < 45)   obj.rotation.y += dt;
  if (obj.rotation.x < 45)   obj.rotation.x += dt;
  if (obj.rotation.z >= 45 && obj.rotation.y >= 45 &&
      obj.rotation.x >= 45 ) return (false) ;
  else
      return (true) ;
}
document.getElementById("setLight").addEventListener(
       "click",function(){
         setColor(light).showModal();
       });
document.getElementById("setCamPos").addEventListener(
       "click",function(){
         setPos(camera).showModal();
       });
</script>

<!--      WEB PAGE DOM ELEMENTS  ------>
<body>
  <div class=container>
    <h2>Payload Thermal Model </h2>
   <button id="setLight">setLight</button>
   <button id="setCamPos">setCamPos</button>
  </div>
</body>
</html>
