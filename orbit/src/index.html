<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/imgs/favicon.png">
      <meta charset="utf-8">
  <script type="importmap">
      {
	"imports": {
	  "three": 
	      "https://unpkg.com/three@v0.154.0/build/three.module.js",
	  "three/addons/":
	      "https://unpkg.com/three@v0.154.0/examples/jsm/"
	}
      }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" 
           integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" 
           crossorigin="anonymous">
  </script>

<style>
  .dlgFrame
  {
    border-radius: 16px 16px 16px 16px;
    box-shadow: 3px 3px 5px #535353;
    background: lightYellow;
  }

</style>
</head>
<!--////////////////////////  END HEADERS ///////////////////-->
<script type=module>
  import  {THREE, GUI, loader, scene, camera, renderer} from "./init.js" ;
  import {Plane} from "./plane.js" ;
  import {light, dlight, lightGUI} from  "./lights.js" ;
  import {setColor, setPos, measure, saveScene} from "./util.js" ;
//  import {OrbitControls} from 'three/addons/controls/OrbitControls'

  let plane = await Plane () ;
  scene.add (plane) ;
  scene.add (light); 
  scene.add (dlight);
  render () ;
           sleep (100).then ( () => { saveScene (); } ) ;
  //animate () ;
  //genImages () ;
//  scene.add (new THREE.AxesHelper(40)) ;


// Functions 
/////////////////////////////////////////////
function genImages () {
  let n = 3 ;
  for (let i = 0 ; i < n ; i ++) {
     for (let j = 0 ; j < n ; j++) {
       for (let k = 0 ; k < n ; k++) {
           render () ;
           sleep (100).then ( () => { saveScene (); } ) ;
       }}}
} 

function sleep (ms) {  // returns a promise
 console.log("Sleeping");
 return new Promise (resolve => setTimeout (resolve, ms)) ;
}

function animate(){
    requestAnimationFrame (animate);
    rotate (plane) ;
    renderer.render (scene, camera);
  }

function render() {
    requestAnimationFrame (render);
    renderer.render (scene, camera);
}

function resize_canvas( x = 512, y = 512 ) {
  // not giving good result
  var  canvas = document.getElementsByTagName('canvas')[0];
  canvas.width = x;
  canvas.height = y;
  camera.aspect = canvas.clientWidth / canvas.clientHeight;
  camera.updateProjectionMatrix();
}

function rotate(obj) {
    obj.rotation.z += 0.1;
    obj.rotation.y += 0.1;
    obj.rotation.x += 0.1;
}
document.getElementById("setLight").addEventListener(
       "click",function(){
         setColor(light).showModal();
       });
document.getElementById("setCamPos").addEventListener(
       "click",function(){
         setPos(camera).showModal();
       });
</script>

<!--      WEB PAGE DOM ELEMENTS  ------>
<body>
  <div class=container>
    <h2>Payload Thermal Model </h2>
   <button id="setLight">setLight</button>
   <button id="setCamPos">setCamPos</button>
  </div>
</body>
</html>
